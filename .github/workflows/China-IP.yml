name: China IP
on:
  schedule:
    - cron: 20 2 */3 * *
  watch:
    types: [started]
jobs:
  build:
    runs-on: ubuntu-18.04
    steps:
    - uses: actions/checkout@v2
    - name: Download China IP
      run: |
        wget https://raw.githubusercontent.com/Hackl0us/GeoIP2-CN/release/CN-ip-cidr.txt
    - name: Create files
      run: |
        sed -i "/^[  ]*$/d" CN-ip-cidr.txt
        sed -i "s/^/IP-CIDR,/" CN-ip-cidr.txt
        mv CN-ip-cidr.txt ChinaIP.list
        cp ChinaIP.list ChinaIP.yaml
        sed -i "s/^/  - /" ChinaIP.yaml
        sed -i 1i\payload: ChinaIP.yaml
    - name: Set variables
      run: |
        echo "TIME=Released on $(date +%Y).$(date +%m).$(date +%d)" >> $GITHUB_ENV
      shell: bash
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        files: |
          ./ChinaIP.list
          ./ChinaIP.yaml
        draft: false
        prerelease: false
        tag_name: China-IP
        name: China IP
        body:  ${{ env.TIME }}
